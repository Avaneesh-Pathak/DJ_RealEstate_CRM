{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 style="font-family: 'Poppins', sans-serif; font-size: xx-large; margin-bottom: 10px;" class="text-center">
        Analysis</h1>
    <div class="row">
        <!-- Total Leads -->
        <div class="col-md-4">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h3>Total Leads</h3>
                    <p class="display-4">{{ total_lead_count }}</p>
                </div>
            </div>
        </div>

        <!-- Leads in the Past 30 Days -->
        <div class="col-md-4">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h3>Leads in the Past 30 Days</h3>
                    <p class="display-4">{{ total_in_past30 }}</p>
                </div>
            </div>
        </div>

        <!-- Converted Leads in the Past 30 Days -->
        <div class="col-md-4">
            <div class="card text-center bg-warning text-white">
                <div class="card-body">
                    <h3>Converted Leads in the Past 30 Days</h3>
                    <p class="display-4">{{ converted_in_past30 }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sales and Profit Section -->
    <div class="row mt-4">
        <!-- Sales Data -->
        <div class="col-md-6">
            <h3 style="font-size:x-large;">Properties Sold Over Time</h3>
            <canvas id="salesChart"></canvas>
        </div>

        <!-- Profit Data -->
        <div class="col-md-6">
            <h3 style="font-size:x-large;">Profit Over Time</h3>
            <canvas id="profitChart"></canvas>
        </div>
    </div>

    <!-- Summary Section -->
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <h3>Total Sales</h3>
                    <p class="display-4">₹{{ total_sales }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center bg-danger text-white">
                <div class="card-body">
                    <h3>Total Cost</h3>
                    <p class="display-4">-₹{{ total_cost }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h3>Total Profit</h3>
                    <p class="display-4">₹{{ total_profit }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Sales Chart -->
<script>
    const salesLabels = {{ labels| safe }};
    const salesData = {{ data| safe }};
    const salesCtx = document.getElementById('salesChart').getContext('2d');

    new Chart(salesCtx, {
        type: 'bar',
        data: {
            labels: salesLabels,
            datasets: [{
                label: 'Properties Sold',
                data: salesData,
                backgroundColor: 'rgb(30, 62, 98,0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgb(30, 62, 98,0.3)',
                pointBorderColor: '#fff', // Point border color
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: 'black'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    titleColor: 'white',
                    bodyColor: 'white'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<!-- Profit Chart -->
<script>
    const profitLabels = {{ profit_labels| safe }};
    const profitData = {{ profit_data| safe }};
    const profitCtx = document.getElementById('profitChart').getContext('2d');

    new Chart(profitCtx, {
        type: 'line',
        data: {
            labels: profitLabels,
            datasets: [{
                label: 'Profit',
                data: profitData,
                backgroundColor: 'rgb(56, 116, 120, 0.8)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: 'black'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    titleColor: 'white',
                    bodyColor: 'white'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

{% endblock content %}
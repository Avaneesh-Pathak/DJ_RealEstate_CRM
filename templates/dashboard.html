{% extends 'base.html' %}

{% block content %}
<style>
    
    /* Additional CSS for hover effect */
    .table tbody tr:hover {
        background-color: #02381c;
    }

    .table {
        border: 2px solid #061a30;
        border-radius: 10px;
        overflow: hidden;
    }
    
</style>
<div class="container mt-4">
    <h1 style="font-family: 'Poppins', sans-serif; font-size: xx-large; margin-bottom: 10px; font-weight: bold;"
        class="text-center">
        Analysis</h1>
    <div class="row">
        <!-- Total Leads -->
        <div class="col-md-4">
            <div style="background-color: #003C43; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Total Leads</h3>
                    <a href="{% url 'leads:lead-list' %}"><p class="display-4">{{ total_lead_count }}</p></a>
                </div>
            </div>
        </div>

        <!-- Leads in the Past 30 Days -->
        <div class="col-md-4">
            <div style="background-color: #003C43; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Leads in the Past 30 Days</h3>
                    <p class="display-4">{{ total_in_past30 }}</p>
                </div>
            </div>
        </div>

        <!-- Converted Leads in the Past 30 Days -->
        <div class="col-md-4">
            <div style="background-color: #003C43; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Converted Leads in the Past 30 Days</h3>
                    <p class="display-4">{{ converted_in_past30 }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sales and Profit Section -->
    <div class="row mt-4">
        <!-- Sales Data -->
        <div class="col-md-6">
            <h3 style="font-size:x-large;  margin-left: 25%; font-weight: bold;">Properties Sold Over Time</h3>
            <canvas id="salesChart"></canvas>
        </div>

        <!-- Profit Data -->
        <div class="col-md-6">
            <h3 style="font-size:x-large;  margin-left: 40%; font-weight: bold;">Profit Over Time</h3>
            <canvas id="profitChart"></canvas>
        </div>
    </div>

    <!-- Summary Section -->
    <div class="row mt-4">
        <div class="col-md-4">
            <div style="background-color: #003C43; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Total Sales</h3>
                    <p class="display-4">₹{{ total_sales }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div style="background-color: #005B41; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Total Cost</h3>
                    <p class="display-4">-₹{{ total_cost }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div style="background-color: #1B4242; color:#feffff" class="card text-center text-white">
                <div class="card-body">
                    <h3>Total Profit</h3>
                    <p class="display-4">₹{{ total_profit }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Section -->
    <div class="row mt-6">
        <div style="height: 350px; width: 450px;" class="col-md-5">
            <h3 style="font-size:x-large;  margin-left: 25%; font-weight: bold;">Salary Distribution from Profit</h3>
            <canvas id="salaryDistributionChart"></canvas>

        </div>

        <div class="col-md-6">
            <h3 style="font-size: x-large; font-weight: bold; text-align: center;">Top 5 Recent Buyers</h3>
            <table class="table table-striped table-bordered "
                style="width: 100%; height: auto; border-radius: 10px; overflow: hidden;">
                <thead style="background-color: #003C43; color:#78A083">
                    <tr>
                        <th style="width: 10%; text-align: center;">S.No</th>
                        <th style="width: 30%; text-align: center;">Buyer Name</th>
                        <th style="width: 20%; text-align: center;">Mobile No</th>
                        <th style="width: 15%; text-align: center;">Project</th>
                        <th style="width: 40%; text-align: center;">Booking Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for buyer in recent_buyers %}
                    <tr style="background-color: #77B0AA; transition: background-color 0.3s;">
                        <td style="text-align: center;">{{ forloop.counter }}.</td>
                        <td style="text-align: center; font-weight: bold;"><a
                                href="{% url 'leads:update_delete_buyer' buyer.id %}"
                                class="text-black-900 hover:underline">{{ buyer.name }}</a></td>
                        <td style="text-align: center;">{{ buyer.mobile_no }}</td>
                        <td style="text-align: center;">{{ buyer.project.title }}</td>
                        <td style="text-align: center;">{{ buyer.booking_date }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: #777;">No buyers available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- FullCalendar CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.js"></script>

<!-- Sales Chart -->
<script>
    const salesLabels = {{ labels| safe }};
    const salesData = {{ data| safe }};
    const salesCtx = document.getElementById('salesChart').getContext('2d');

    new Chart(salesCtx, {
        type: 'bar',
        data: {
            labels: salesLabels,
            datasets: [{
                label: 'Properties Sold',
                data: salesData,
                backgroundColor: 'rgba(30, 62, 98, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(30, 62, 98, 0.3)',
                pointBorderColor: '#fff',
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true, labels: { color: 'black' } },
                tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.7)', titleColor: 'white', bodyColor: 'white' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

<!-- Profit Chart -->
<script>
    const profitLabels = {{ profit_labels| safe }};
    const profitData = {{ profit_data| safe }};
    const profitCtx = document.getElementById('profitChart').getContext('2d');

    new Chart(profitCtx, {
        type: 'line',
        data: {
            labels: profitLabels,
            datasets: [{
                label: 'Profit',
                data: profitData,
                backgroundColor: 'rgba(56, 116, 120, 0.8)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true, labels: { color: 'black' } },
                tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.7)', titleColor: 'white', bodyColor: 'white' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
<!-- Salary -->

<script>
    const salaryDistributionLabels = {{ salaryDistribution_labels|safe }};
    const salaryDistributionData = {{ salary_distribution|safe }}; 
    const salaryDistributionCtx = document.getElementById('salaryDistributionChart').getContext('2d');

    new Chart(salaryDistributionCtx, {
        type: 'bar',
        data: {
            labels: salaryDistributionLabels,
            datasets: [{
                data: salaryDistributionData,
                backgroundColor: ['#77B0AA', '#04364A'],  // Colors for each slice
                borderColor: '#35374B',
                borderWidth: 1,
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Salary Distribution from Profit',
                },
            }
        }
    });
</script>



{% endblock content %}